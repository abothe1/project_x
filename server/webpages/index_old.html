<!DOCTYPE html>
<html>
<head>
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script type ="text/javascript">

	var socketio = io.connect();
	socketio.on("message_to_client", data => {
		//Append an HR thematic break and the escaped HTML of the new message
		document.getElementById("chatlog").appendChild(document.createElement("hr"));
		document.getElementById("chatlog").appendChild(document.createTextNode(data['message']));
	});
	socketio.on("create-user-response", data => {
		alert(JSON.stringify(data));
	});
	socketio.on("login-user-response", data => {
		alert(JSON.stringify(data));
	});

	function sendMessage(){
		var msg = $("#message_input").val();

		$.post("/__add_status", {msg: msg}, res => {
			if(res.success) {
				$('#chatlog').append('<hr>');
				$('#chatlog').append(`<text>${res.msg}</text>`);
			} else {
				alert(`error: ${res.error}`);
			}
		});

	}

	function register() {
		var username = $("#username").val();
		var email = $("#email").val();
		var password = $("#password").val();
		socketio.emit("create-user", {username:username, password:password, email: email});
	}

	function login() {
		var username = $("#username").val();
		var password = $("#password").val();
		console.log(`${username}: ${password}`);
		socketio.emit("login-user", {username:username, password:password});
	}
</script>
</head>
<body>
	username: <input type=username id="username"/><br>
	email: <input type=password id="email"/><br>
	password: <input type=text" id="password"/><br>
	<button onclick="register()">register</button>
	<button onclick="login()">login</button>
	<br>
	<input type=text" id="message_input"/>
	<button onclick="sendMessage()">send</button>
	<div id="chatlog"></div>
</body>
</html>